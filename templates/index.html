<!doctype html>
<html>

<head>
    <title>Mana Simulation</title>
    <!-- Include Vega, Vega-Lite, and vega-embed libraries -->
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .container {
            display: flex;
        }

        .form-container {
            width: 20%;
        }

        .result-container {
            width: 60%;
            padding-left: 20px;
        }

        input,
        textarea {
            width: 100%;
            padding: 8px;
            margin: 4px 0 10px 0;
            box-sizing: border-box;
        }

        textarea {
            height: 180px;
        }

        label {
            font-weight: bold;
        }

        button {
            padding: 10px 20px;
        }

        #loading {
            display: none;
            font-style: italic;
            color: #555;
        }
    </style>
</head>

<body>
    <h1>Mana Simulation</h1>
    <div class="container">
        <div class="form-container">
            <form id="simulation-form">
                <label for="deck_size">Deck Size:</label>
                <input type="number" id="deck_size" name="deck_size" value="40" required>

                <label for="hand_size">Initial Hand Size:</label>
                <input type="number" id="hand_size" name="hand_size" value="7" required>

                <label for="draws">Number of Draw Steps:</label>
                <input type="number" id="draws" name="draws" value="10" required>

                <label for="simulations">Number of Simulations:</label>
                <input type="number" id="simulations" name="simulations" value="1000" required>

                <label for="seed">Random Seed:</label>
                <input type="number" id="seed" name="seed" value="42" required>

                <label for="spells_json">Spells (JSON):</label>
                <textarea id="spells_json" name="spells_json">
{
    "U": 6,
    "B": 5,
    "W": 4,
    "WB": 1,
    "UB": 1,
    "WU": 1
}
                </textarea>

                <label for="mana_json">Mana (JSON):</label>
                <textarea id="mana_json" name="mana_json">
{
    "U": 5,
    "B": 4,
    "W": 4,
    "UB": 1,
    "WB": 1,
    "WU": 1,
    "WUBRG": 1
}
                </textarea>

                <button type="submit">Run Simulation</button>
            </form>
            <p id="loading">Running simulation, please wait...</p>
        </div>
        <div class="result-container">
            <div id="chart-result">
                <!-- The simulation chart will appear here -->
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('simulation-form');
        const loading = document.getElementById('loading');
        const resultContainer = document.getElementById('chart-result');

        form.addEventListener('submit', function (e) {
            e.preventDefault();
            loading.style.display = 'block';
            resultContainer.innerHTML = '';

            // Collect form data into a JSON object.
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });

            // Post the form data to our /simulate endpoint.
            fetch('/simulate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(json => {
                    loading.style.display = 'none';
                    if (json.error) {
                        resultContainer.innerHTML = 'Error: ' + json.error;
                    } else {
                        // Embed the chart using the returned Vega-Lite spec
                        vegaEmbed('#chart-result', json.chart_spec);
                    }
                })
                .catch(error => {
                    loading.style.display = 'none';
                    resultContainer.innerHTML = 'Error: ' + error;
                });
        });
    </script>
</body>

</html>